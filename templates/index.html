<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ç”»åƒå‡¦ç† Webã‚¢ãƒ—ãƒª</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='style.css')}}">
</head>
<body>
    <h1>ç”»åƒå‡¦ç† Webã‚¢ãƒ—ãƒª</h1>
    
    <div class="container">
        <!-- å·¦ãƒ‘ãƒãƒ«ï¼šãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ† -->
        <div class="left-panel">
            <form id="image-form" enctype="multipart/form-data">
                <div class="file-upload-wrapper">
                    <input type="file" name="file" id="file-input" accept="image/*" required>
                    <label for="file-input" class="file-upload-label">
                        ğŸ“ ç”»åƒã‚’é¸æŠ
                    </label>
                    <span class="file-name" id="file-name"></span>
                </div>

                <h3>å‡¦ç†ãƒ¢ãƒ¼ãƒ‰é¸æŠ</h3>
                <div class="checkbox-wrapper">
                    <input type="checkbox" name="mode_mosaic" id="mode-mosaic" onclick="toggleParams()">
                    <label for="mode-mosaic" class="checkbox-label">ãƒ¢ã‚¶ã‚¤ã‚¯ã‚¢ãƒ¼ãƒˆ</label>
                </div>
                <div class="checkbox-wrapper">
                    <input type="checkbox" name="mode_popart" id="mode-popart" onclick="toggleParams()">
                    <label for="mode-popart" class="checkbox-label">ãƒãƒƒãƒ—ã‚¢ãƒ¼ãƒˆ</label>
                </div>
                <hr>

                <div id="mosaic-params" class="slider-wrapper">
                    <label for="mosaic_level">ãƒ¢ã‚¶ã‚¤ã‚¯ã®ç²—ã•:</label>
                    <input type="range" name="mosaic_level" id="mosaic_level_slider" min="2" max="50" value="10" oninput="this.nextElementSibling.value=this.value">
                    <output>10</output>
                </div>

                <div id="popart-params" class="slider-wrapper" style="display:none;">
                    <label for="hue_shift">è‰²ç›¸ã‚·ãƒ•ãƒˆ</label>
                    <input type="range" name="hue_shift" id="hue_shift_slider" min="0" max="255" value="100" oninput="this.nextElementSibling.value=this.value">
                    <output>100</output>
                </div>
                <button type="submit" id="submit-btn">ç”»åƒã‚’å‡¦ç†</button>
            </form>
        </div>

        <!-- å³ãƒ‘ãƒãƒ«ï¼šå‡¦ç†çµæœ -->
        <div class="right-panel">
            <h2>å‡¦ç†çµæœ</h2>
            <div id="result">
                <p id="time-display" style="display:none;"></p>
                <img id="processed-image" src="" style="display: none;" alt="å‡¦ç†çµæœã®ç”»åƒ">
            </div>
        </div>
    </div>

    <script>
        //submitã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ã‚³ãƒ¼ãƒ‰
        document.getElementById('image-form').addEventListener('submit',function(e){e.preventDefault(); //ãƒ•ã‚©ãƒ¼ãƒ ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é€ä¿¡ã•ã‚ŒãŸå¾Œç”»é¢é·ç§»ã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã‚‹
            const form = e.target;
            const formData = new FormData(form);
            // é€ã‚‰ã‚Œã¦ããŸå…¨ãƒ‡ãƒ¼ã‚¿(ãƒ•ã‚¡ã‚¤ãƒ«+ç²—ã•orè‰²å½©)ã‚’formDataã«æ ¼ç´
            const imageElement = document.getElementById('processed-image');
            const timeDisplay = document.getElementById('time-display');
            const resultDiv = document.getElementById('result');
            fetch('/process',{  //fetchã§éåŒæœŸã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡
                method:'POST',
                body:formData
            })
            .then(response=> {
                if(response.ok){
                    return response.json(); //blob()â†’json()ã«å¤‰æ›´.Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã¯ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãŸã‚ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
                }
                throw new Error('ç”»åƒå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
            })
            .then(data=>{ //dataã¯{image_data:"...",process_time:0.123}ã®å½¢å¼
                //ç”»åƒã®è¡¨ç¤º
                imageElement.src = data.image_data;  //base64ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥srcã«è¨­å®š
                imageElement.style.display = 'block';
                //å‡¦ç†æ™‚é–“ã®è¡¨ç¤º
                timeDisplay.textContent=`å‡¦ç†æ™‚é–“: ${data.process_time} ç§’`;
                timeDisplay.style.display = 'block'; //è¡¨ç¤ºã•ã›ã‚‹
            })
            .catch(error=>{ //ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¯javaã¨åŒã˜
                console.error('Error:',error);
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ');
            });
        });

        //ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        function toggleParams(){//toggleâ‡’åˆ‡æ›¿ã€paramsâ‡’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿.ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã®é–¢æ•°
            const isMosaic = document.getElementById('mode-mosaic').checked;    //.checkedã§mode-mosaicãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹(é¸æŠã•ã‚Œã¦ã„ã‚Œã°true)
            const isPopart = document.getElementById('mode-popart').checked;
            document.getElementById('mosaic-params').style.display=isMosaic?'block' : 'none';
            document.getElementById('popart-params').style.display=isPopart?'block' : 'none';
        }
        toggleParams(); //åˆæœŸè¡¨ç¤ºã®ãŸã‚ã«ä¸€åº¦å‘¼ã³å‡ºã—ã¦ã„ã‚‹
    // ãƒ•ã‚¡ã‚¤ãƒ«åè¡¨ç¤ºç”¨ã®ã‚³ãƒ¼ãƒ‰
        document.getElementById('file-input').addEventListener('change', function(e) {
            const fileName = e.target.files[0]?.name || '';
            document.getElementById('file-name').textContent = fileName ? `é¸æŠ: ${fileName}` : '';
        });
        document.getElementById('file-input').addEventListener('change', function(e) {
        const fileName = e.target.files[0]?.name || '';
        document.getElementById('file-name').textContent = fileName ? `é¸æŠ: ${fileName}` : '';
        });
    </script>

</body>
</html>