<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>画像処理 Webアプリ</title>
</head>
<body>
    <h1>画像をアップロード</h1>

    <form id="image-form" enctype="multipart/form-data">
        <input type="file" name="file" accept="image/*" required>
        <label for="mosaic_level">モザイクの粗さ:</label>
        <input type="range" name="mosaic_level" id="mosaic_level_slider" min="2" max="50" value="10" oninput="this.nextElementSibling.value=this.value">
        <output>10</output>
        <button type="submit" id="submit-btn">画像をモザイク化</button>
    </form>

    <h2>処理結果</h2>
    <div id="result">
        <img id="processed-image" src="" style="max-width: 100%; display: none;"alt="処理結果の画像"> 
        <!-- display noneで画像を非表示状態にしている -->
    </div>

    <script>
        document.getElementById('image-form').addEventListener('submit',function(e){e.preventDefault(); //フォームがデフォルトで送信された後画面遷移しないようにしている
            const form = e.target;
            const formData = new FormData(form);
            // 送られてきた全データ(ファイル+粗さ)をformDataに格納
            const imageElement = document.getElementById('processed-image');
            fetch('/process',{  //fetchで非同期でデータを送信
                method:'POST',
                body:formData
            })
            .then(response=> {
                if(response.ok){
                    return response.blob();
                }
                throw new Error('画像処理に失敗しました');
            })
            .then(imageBlob=>{//Blobオブジェクトとは画像データを扱うためのオブジェクト
                const imageObjectURL = URL.createObjectURL(imageBlob); //下で使うためのURLを生成(もとはBlobオブジェクト)
                imageElement.src = imageObjectURL;  //processed-imageのsrc属性にURLをセット
                imageElement.style.display = 'block';
            })
            .catch(error=>{
                console.error('Error:',error);
                alert('エラーが発生');
            });
        });
    </script>

</body>
</html>